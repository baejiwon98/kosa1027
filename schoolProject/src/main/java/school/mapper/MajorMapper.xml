<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace = "school.mapper.MajorMapper">

<select id="selectProfessor" parameterType="String" resultType="ProfessorDTO">
	select professor_num professorNum, department_num departmentNum, 
	professor_id professorId, professor_pw professorPw, professor_name professorName, 
	professor_phone professorPhone, professor_email professorEmail 
	from professor
	where professor_num in (select professor_num from professor_subject where subject_num = #{subjectNum})
</select>

<select id="selectSubject" parameterType="String" resultType="SubjectDTO">
	select subject_num subjectNum, subject_name subjectName, subject_title subjectTitle, subject_content subjectContent 
	from subject where subject_num in 
	(select distinct subject_num from professor_subject where professor_num in
	(select professor_num from professor where department_num = #{departmentNum}))
</select>

<delete id="majorDelete" parameterType="String">
	delete from department where department_num = #{departmentNum}
</delete>

<update id="majorUpdate" parameterType="MajorDTO">
update department set department_num =#{departmentNum}, department_name =#{departmentName}, 
	department_phone = #{departmentPhone}, department_addr = #{departmentAddr}, 
	fullAddr =#{fullAddr}, addr1 =#{addr1}, addr2 = #{addr2}, detailAddr = #{detailAddr}, zip = #{zip}
	where department_num = #{departmentNum}
</update>

<select id="selectOne" resultType="MajorDTO" parameterType="String">
	select department_num departmentNum, department_name departmentName, 
	department_phone departmentPhone, department_addr departmentAddr, 
	fullAddr fullAddr, addr1 addr1, addr2 addr2, detailAddr detailAddr, zip zip from department
	where department_num = #{departmentNum}
</select>

<select id="majorCount" resultType="int">
	select count(*) from department
</select>

<select id="selectAll" resultType="MajorDTO" parameterType="StartEndPageDTO">
	select * from
	(select rownum rn, department_num departmentNum, department_name departmentName, 
	department_phone departmentPhone, department_addr departmentAddr,
	fullAddr fullAddr, addr1 addr1, addr2 addr2, detailAddr detailAddr, zip zip from department)
	<if test="startRow != null">
	where rn between #{startRow} and #{endRow}
	</if>
</select>

<select id="autoNum" resultType="String">
select seq_1.nextval from dual
</select>

<insert id="majorInsert" parameterType="MajorDTO">
insert into department (department_num, department_name, department_phone, department_addr, fullAddr, addr1, addr2, detailAddr, zip) 
values (#{departmentNum}, #{departmentName}, #{departmentPhone}, #{departmentAddr}, #{fullAddr}, #{addr1}, #{addr2}, #{detailAddr}, #{zip})
</insert>

</mapper>
